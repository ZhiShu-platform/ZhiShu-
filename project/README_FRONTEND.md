# 智枢应急管理系统 - 前端使用说明

## 🚀 系统概述

智枢应急管理系统是一个基于MCP（Model Context Protocol）的智能体工作流管理平台，提供：

- **工作流管理**: 可视化工作流设计、执行和监控
- **MCP服务控制**: 统一管理各种灾害评估模型服务
- **AI智能分析**: 基于大语言模型的智能对话分析
- **实时监控**: 系统状态、性能指标和日志监控
- **响应式设计**: 支持桌面和移动设备访问

## 🏗️ 系统架构

```
前端 (Vue 3 + Vite)
    ↓
后端API (Node.js + Express)
    ↓
MCP服务管理器 (Python)
    ↓
各种模型服务 (NFDRS4, LISFLOOD, CLIMADA等)
```

## 📋 功能特性

### 1. 工作流管理
- **工作流定义**: 预定义多种灾害评估工作流
- **实例管理**: 启动、监控、取消工作流实例
- **步骤跟踪**: 实时查看工作流执行进度
- **结果展示**: 可视化工作流执行结果

### 2. MCP服务控制
- **服务状态**: 实时监控各模型服务运行状态
- **服务控制**: 启动、停止、重启服务
- **批量操作**: 一键启动/停止所有服务
- **健康检查**: 自动检测服务健康状态

### 3. AI智能分析
- **智能对话**: 与AI分析师进行自然语言交互
- **多模型集成**: 支持多种灾害评估模型
- **上下文理解**: 保持对话上下文连续性
- **结果解释**: 智能分析结果解释和建议

### 4. 系统监控
- **实时状态**: 系统整体运行状态概览
- **性能指标**: CPU、内存、磁盘使用率
- **日志查看**: 实时系统日志监控
- **数据导出**: 支持监控数据导出

## 🚀 快速开始

### 环境要求
- Node.js >= 16.0.0
- Python >= 3.8
- Conda (推荐)

### 安装步骤

1. **克隆项目**
```bash
git clone <repository-url>
cd project
```

2. **安装依赖**
```bash
# 安装Node.js依赖
npm install

# 安装Python依赖
pip install -r requirements.txt
```

3. **启动系统**
```bash
# 使用启动脚本（推荐）
chmod +x start_system.sh
./start_system.sh

# 或手动启动
npm run start:all
```

4. **访问系统**
- 前端界面: http://localhost:3000
- 后端API: http://localhost:3000
- 工作流管理: http://localhost:3000/workflow

## 📱 界面使用指南

### 主仪表板

系统启动后，您将看到主仪表板界面，包含三个主要标签页：

#### 1. 📊 工作流管理
- **MCP服务状态**: 查看所有模型服务的运行状态
- **服务控制**: 启动、停止、重启单个或所有服务
- **工作流实例**: 查看正在运行和已完成的工作流
- **工作流启动**: 选择预定义工作流并配置参数启动

#### 2. 💬 AI智能分析
- **智能对话**: 与AI分析师进行自然语言交互
- **问题分析**: 输入灾害相关问题，获得智能分析
- **多模型调用**: AI自动调用相关模型进行分析
- **结果展示**: 查看分析过程和结果

#### 3. 📈 系统监控
- **系统概览**: 快速查看系统整体状态
- **详细监控**: 深入查看各组件状态
- **实时日志**: 监控系统运行日志
- **性能图表**: 查看系统性能趋势

### 工作流管理详细说明

#### 启动工作流
1. 点击"启动工作流"按钮
2. 选择要执行的工作流类型
3. 配置工作流参数（地点、坐标等）
4. 点击"启动工作流"开始执行

#### 监控工作流执行
1. 在工作流实例列表中查看执行状态
2. 点击"查看详情"查看详细执行步骤
3. 实时监控每个步骤的执行状态
4. 查看执行结果和错误信息

#### 管理MCP服务
1. 在MCP服务状态区域查看所有服务
2. 使用服务控制按钮管理单个服务
3. 使用批量操作按钮管理所有服务
4. 监控服务运行状态和错误信息

## 🔧 配置说明

### 环境变量配置

创建 `.env` 文件配置环境变量：

```env
# 数据库配置
DB_HOST=localhost
DB_PORT=5432
DB_NAME=zs_data
DB_USER=zs_zzr
DB_PASSWORD=your_password

# MCP服务配置
MCP_HOST=localhost
MCP_PORT=8000

# 前端配置
VITE_API_BASE_URL=http://localhost:3000
VITE_WS_BASE_URL=ws://localhost:3000
```

### 工作流配置

在 `backend/workflow-definitions.js` 中配置预定义工作流：

```javascript
const workflowDefinitions = [
  {
    name: 'custom_workflow',
    description: '自定义工作流',
    steps: [
      // 定义工作流步骤
    ],
    parameters_schema: {
      // 定义参数模式
    }
  }
]
```

## 📊 数据流说明

### 工作流执行流程

```
用户启动工作流 → 后端API接收请求 → 创建工作流实例 → 
MCP服务管理器调用相关服务 → 执行各个步骤 → 
保存结果到数据库 → 通过GeoServer发布到前端
```

### MCP调用流程

```
前端发起MCP调用 → 后端API验证请求 → 
检查服务状态 → 调用MCP服务 → 
处理返回结果 → 返回给前端
```

## 🐛 故障排除

### 常见问题

1. **服务启动失败**
   - 检查conda环境是否正确激活
   - 检查Python依赖是否完整安装
   - 查看日志文件获取详细错误信息

2. **前端无法连接后端**
   - 检查后端服务是否正常启动
   - 检查端口是否被占用
   - 检查防火墙设置

3. **工作流执行失败**
   - 检查相关MCP服务是否运行
   - 检查工作流参数配置
   - 查看工作流执行日志

### 日志查看

```bash
# 查看MCP管理器日志
tail -f logs/mcp_manager.log

# 查看后端服务日志
tail -f logs/backend.log

# 查看前端构建日志
npm run build
```

## 🔒 安全说明

- 系统默认运行在本地环境
- 生产环境部署时请配置适当的认证和授权
- 定期更新依赖包以修复安全漏洞
- 监控系统访问日志

## 📈 性能优化

### 前端优化
- 使用Vue 3 Composition API提高性能
- 实现组件懒加载
- 优化图片和资源加载
- 使用CDN加速静态资源

### 后端优化
- 实现API缓存机制
- 使用连接池管理数据库连接
- 实现请求限流和熔断
- 优化数据库查询性能

## 🔮 未来规划

- [ ] 支持更多灾害评估模型
- [ ] 实现工作流可视化编辑器
- [ ] 添加机器学习模型训练功能
- [ ] 支持分布式部署
- [ ] 集成更多数据源
- [ ] 实现移动端应用

## 📞 技术支持

如果您在使用过程中遇到问题，请：

1. 查看本文档的故障排除部分
2. 检查系统日志获取错误信息
3. 提交Issue到项目仓库
4. 联系技术支持团队

## 📄 许可证

本项目采用 MIT 许可证，详见 [LICENSE](LICENSE) 文件。

---

**智枢应急管理系统** - 让灾害响应更智能、更高效！ 🚀
